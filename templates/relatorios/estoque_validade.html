<!-- templates/relatorios/estoque_validade.html -->
{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h2>Produtos Pr√≥ximos do Vencimento</h2>
    <div class="mb-3">
        <input type="number" id="dias" value="30" class="form-control d-inline w-auto">
        <button onclick="loadData()" class="btn btn-primary">Atualizar</button>
    </div>
    
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Produto</th>
                <th>Data Validade</th>
                <th>Dias Restantes</th>
            </tr>
        </thead>
        <tbody id="tabela-dados">
        </tbody>
    </table>
</div>

{% block scripts %}
<script>
function loadData() {
    const dias = document.getElementById('dias').value;
    
    fetch(`/relatorios/estoque/validade?dias=${dias}`)
        .then(response => response.json())
        .then(data => {
            let html = '';
            data.forEach(item => {
                html += `
                    <tr class="${item.dias_restantes < 7 ? 'table-warning' : ''}">
                        <td>${item.nome}</td>
                        <td>${new Date(item.data_validade).toLocaleDateString()}</td>
                        <td>${Math.round(item.dias_restantes)} dias</td>
                    </tr>
                `;
            });
            document.getElementById('tabela-dados').innerHTML = html;
        });
}

// Carregar dados iniciais
window.onload = loadData;
</script>
{% endblock %}
{% endblock %}